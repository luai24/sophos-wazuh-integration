<!--
  - Sophos Firewall CRF Syslog Rules for Wazuh
  - Developed by Luai Ehsan
  - MITRE ATT&CK techniques mapped where relevant
  - ğŸ“š Reference: https://docs.sophos.com/nsg/sophos-firewall/20.0/pdf/sf-syslog-guide-20.0.pdf
-->

<group name="sophos_fw_ng">
    <!-- Base decoder match -->
    <rule id="113800" level="0">
        <decoded_as>sophos-fw-ng</decoded_as>
        <description>ğŸ§± Base rule for Sophos Firewall event decoding</description>
    </rule>

    <!-- ğŸ›‘ Web Filtering -->
    <rule id="113862" level="7">
        <if_sid>113800</if_sid>
        <field name="log_type">Content Filtering</field>
        <field name="log_subtype">Denied</field>
        <description>ğŸš« Web Policy Violation on Sophos Firewall</description>
        <mitre><id>T1567.002</id></mitre>
    </rule>

    <!-- ğŸ” CLI login failures -->
    <rule id="113863" level="8">
        <if_sid>113800</if_sid>
        <field name="log_component">CLI</field>
        <field name="log_type">Event</field>
        <field name="sophos_fw_status">Failed</field>
        <description>ğŸ§‘â€ğŸ’» Failed CLI Login (SSH) on Sophos Firewall</description>
        <mitre><id>T1110</id></mitre>
    </rule>

    <!-- ğŸ” SSL VPN Authentication Failed -->
    <rule id="113864" level="8">
        <if_sid>113800</if_sid>
        <field name="log_component">SSL VPN Authentication</field>
        <field name="log_type">Event</field>
        <field name="sophos_fw_status">Failed</field>
        <description>ğŸ›¡ï¸ Failed SSL VPN Login on Sophos Firewall</description>
        <mitre><id>T1133</id></mitre>
    </rule>

    <!-- ğŸ¦  Web Anti-Virus -->
    <rule id="113870" level="10">
        <if_sid>113800</if_sid>
        <field name="log_type">Anti-Virus</field>
        <field name="log_component">HTTP</field>
        <field name="log_subtype">Virus</field>
        <description>ğŸ¦  Virus Detected in HTTP Traffic</description>
        <mitre><id>T1059</id></mitre>
    </rule>

    <rule id="113871" level="10">
        <if_sid>113800</if_sid>
        <field name="log_type">Anti-Virus</field>
        <field name="log_component">HTTPS</field>
        <field name="log_subtype">Virus</field>
        <description>ğŸ¦  Virus Detected in HTTPS Traffic</description>
        <mitre><id>T1059</id></mitre>
    </rule>

    <!-- ğŸ“¥ FTP AV Detection -->
    <rule id="113872" level="10">
        <if_sid>113800</if_sid>
        <field name="log_type">Anti-Virus</field>
        <field name="log_component">FTP</field>
        <field name="log_subtype">Virus</field>
        <description>ğŸ“¥ FTP Virus Upload/Download Detected</description>
        <mitre><id>T1105</id></mitre>
    </rule>

    <!-- ğŸ“§ Email AV -->
    <rule id="113873" level="10">
        <if_sid>113800</if_sid>
        <field name="log_type">Anti-Virus</field>
        <field name="log_component">SMTP</field>
        <field name="log_subtype">Virus</field>
        <description>ğŸ“§ Email Virus Detected on SMTP</description>
        <mitre><id>T1566.001</id></mitre>
    </rule>

    <!-- ğŸš¨ Anti-Spam -->
    <rule id="113874" level="7">
        <if_sid>113800</if_sid>
        <field name="log_type">Anti-Spam</field>
        <field name="log_component">SMTP</field>
        <field name="log_subtype">Spam</field>
        <description>ğŸ›‘ Spam Email Quarantined</description>
        <mitre><id>T1566</id></mitre>
    </rule>

    <!-- ğŸš« Application Control -->
    <rule id="113875" level="6">
        <if_sid>113800</if_sid>
        <field name="log_type">Content Filtering</field>
        <field name="log_component">Application</field>
        <field name="log_subtype">Denied</field>
        <description>ğŸš· Blocked Application: $(app_name)</description>
        <mitre><id>T1218</id></mitre>
    </rule>

    <!-- ğŸŒ SSL VPN Session Established -->
    <rule id="113876" level="5">
        <if_sid>113800</if_sid>
        <field name="log_component">SSL VPN</field>
        <field name="log_subtype">System</field>
        <field name="sophos_fw_status">Established</field>
        <description>ğŸ”Œ SSL VPN Session Established</description>
        <mitre><id>T1133</id></mitre>
    </rule>

    <!-- ğŸ’¥ IPS Alert -->
    <rule id="113877" level="10">
        <if_sid>113800</if_sid>
        <field name="log_type">IPS</field>
        <field name="log_subtype">Alert</field>
        <description>ğŸ’£ IPS Alert: Potential Exploit Attempt</description>
        <mitre><id>T1203</id></mitre>
    </rule>

    <!-- ğŸš¨ ATP Alert -->
    <rule id="113878" level="10">
        <if_sid>113800</if_sid>
        <field name="log_type">ATP</field>
        <field name="log_subtype">Alert</field>
        <description>ğŸ§  ATP Alert: $(malware) from $(src_ip)</description>
        <mitre><id>T1040</id></mitre>
    </rule>

    <!-- ğŸ”¥ Firewall Events -->
    <rule id="113801" level="5">
        <if_sid>113800</if_sid>
        <field name="log_type">Firewall</field>
        <field name="log_subtype">Denied</field>
        <description>â›” Firewall Denied Connection from $(src_ip) to $(dst_ip)</description>
        <mitre><id>T1040</id></mitre>
    </rule>

    <rule id="113802" level="3">
        <if_sid>113800</if_sid>
        <field name="log_type">Firewall</field>
        <field name="log_subtype">Allowed</field>
        <description>âœ… Firewall Allowed Connection from $(src_ip) to $(dst_ip)</description>
        <mitre><id>T1071</id></mitre>
    </rule>

    <rule id="113803" level="6">
        <if_sid>113800</if_sid>
        <field name="log_type">Firewall</field>
        <field name="log_subtype">Drop</field>
        <description>ğŸ§± Firewall Dropped Connection from $(src_ip) to $(dst_ip)</description>
        <mitre><id>T1040</id></mitre>
    </rule>

    <!-- ğŸ” Authentication Events -->
    <rule id="113820" level="5">
        <if_sid>113800</if_sid>
        <field name="log_subtype">Authentication</field>
        <field name="log_component">Firewall Authentication</field>
        <description>ğŸ” Auth Event: $(message)</description>
        <mitre><id>T1078</id></mitre>
    </rule>

    <!-- âš™ï¸ System Events -->
    <rule id="113840" level="3">
        <if_sid>113800</if_sid>
        <field name="log_component">DDNS</field>
        <description>ğŸ”„ DDNS Update Event: $(message)</description>
        <mitre><id>T1583.001</id></mitre>
    </rule>

    <rule id="113841" level="3">
        <if_sid>113800</if_sid>
        <field name="log_component">DHCP</field>
        <description>ğŸ“¡ DHCP Lease Event: $(message)</description>
        <mitre><id>T1200</id></mitre>
    </rule>
</group>
